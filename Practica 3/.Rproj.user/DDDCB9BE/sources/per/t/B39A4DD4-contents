#source('practica1script.R')

library(caret)
library(rmarkdown)

#Crear un modelo de RLM para predecir la puntuación de la felicidad (HS) a partir de:
# - Indicador de renta per cápita (GpC)
# - Esperanza de vida en salud (LE)
# - Corrupción (GC)
head(mydata)
HS_PredictorModel_3p <- lm(HS ~ GpC + LE + GC, mydata)
summary(HS_PredictorModel_3p)
varImp(HS_PredictorModel_3p, scale = FALSE)

layout(matrix(c(1,1,2,3),2,2,byrow=T))
#Spend x Residuals Plot
plot(HS_PredictorModel_3p$resid~mydata$HS[order(mydata$HS)],
            main="HS x Residuals\nfor Multiple Regression with 3 predictors",
            xlab="HS", ylab= "Residuals")
abline(h=0,lty=2)
#Histogram of Residuals
hist(HS_PredictorModel_3p$resid, main = "Histogram of Residuals", ylab = "Residuals")
#Q-Q Plot
qqnorm(HS_PredictorModel_3p$resid)
qqline(HS_PredictorModel_3p$resid)


levels(mydata_ej2$Region) <- relevel(mydata_ej2$Region, ref = "WESTERN EUROPE")
HS_PredictorModel_4p <- lm(HS ~ Region + GpC + LE + GC, mydata)
summary(HS_PredictorModel_4p)
varImp(HS_PredictorModel_4p, scale = FALSE)

layout(matrix(c(1,1,2,3),2,2,byrow=T))
#Spend x Residuals Plot
plot(HS_PredictorModel_4p$resid~mydata$HS[order(mydata$HS)],
     main="HS x Residuals\nfor Multiple Regression with",
     xlab="HS", ylab= "Residuals")
abline(h=0,lty=2)
#Histogram of Residuals
hist(HS_PredictorModel_4p$resid, main = "Histogram of Residuals", ylab = "Residuals")
#Q-Q Plot
qqnorm(HS_PredictorModel_4p$resid)
qqline(HS_PredictorModel_4p$resid)

GpC_example <- 1.5
LE_example <- 0.69
GC_example <- 0.35

newcountry <- list("Country" = as.factor("WonderLand") , "Region" = as.factor("WESTERN EUROPE"), "HR" = 0, "HS" = 0, "LCI" = 0, "UCI" = 0, "GpC" = GpC_example, "Family" = 0, "LE" = LE_example, "Freedom" = 0, "GC" = GC_example, "Generosity" = 0, "DR" = 0)
mydata_bis <- mydata

mydata_bis <- rbind(mydata_bis, newcountry)

mysolution_3p <- predict(HS_PredictorModel_3p, mydata_bis[158,])
mysolution_3pb <- predict(HS_PredictorModel_3p,list("GpC" = GpC_example, "LE" = LE_example, "GC" = GC_example))

mysolution_4p <- predict(HS_PredictorModel_4p, mydata_bis[158,])

mysolution_3p
mysolution_4p


      